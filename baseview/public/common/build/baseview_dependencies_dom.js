/*!
* Common client JS-dependencies
* (c) Publish Lab AS
* https://www.labradorcms.com
*/
(()=>{"use strict";var t,e;!function(){const t=document.querySelectorAll("[data-expandable]"),e=t=>{t.preventDefault(),t.stopPropagation(),t.currentTarget.classList.toggle("expanded")};for(const i of t)i.addEventListener("click",e,!1)}(),function(){var t=null,e=null,i={max:{width:1740,height:1740},buffer:140,window:{width:window.innerWidth,height:window.innerHeight}},s=document.querySelectorAll("figure[data-zoomable='1']");if(s.length)for(var n=function(t){t.addEventListener("click",(function(e){r(t)}),!1)},r=function(s){t||((t=document.createElement("div")).classList.add("imagezoom"),(e=document.createElement("div")).classList.add("content"),t.appendChild(e),document.body.appendChild(t));var n=s.querySelector("img");if(!n)return;var r=n.width/n.height;if(!r)return;i.window.width=window.innerWidth,i.window.height=window.innerHeight;var o=Math.min(i.max.width,i.window.width),h=o/r,c=h-Math.min(i.max.height,i.window.height);c>0&&(h-=c,o-=c*r),o=Math.round(1.5*o),h=Math.round(1.5*h);var d=s.cloneNode(!0),u=d.querySelector("img"),m=u.currentSrc?u.currentSrc:u.src;const g=d.querySelectorAll("source"),v=m+"&width="+o+"&height="+h;for(const t of g)t.setAttribute("srcset",v);u.setAttribute("src",v),u.removeAttribute("width"),u.removeAttribute("height"),d.classList.add("image-loading");const f=u.getAttribute("style")||"";for(u.style.width="100vw",u.addEventListener("load",(t=>{u.setAttribute("style",f),d.classList.remove("image-loading")}),!1),u.addEventListener("click",(function(t){l()}),!1),e.setAttribute("data-isWide",r>=1?"true":"false");e.firstChild;)e.removeChild(e.firstChild);e.appendChild(d);const p=document.createElement("span");p.setAttribute("title","Close (Escape)"),p.classList.add("close-btn","fi-x"),p.addEventListener("click",(function(t){l()}),!1),e.appendChild(p),a()},o=function(t){"Escape"==t.key&&l()},a=function(){t.classList.add("visible"),document.addEventListener("keydown",o,!1)},l=function(){t.classList.remove("visible"),document.removeEventListener("keydown",o,!1)},h=0;h<s.length;h++)n(s[h])}(),window.Dac||(window.Dac={}),window.Dac.AutoScroller=function(t,e,i){var s=null;if(t){var n=t.querySelector("ul.articles");if(n){var r=n.children;if(r.length){var o=t.querySelector("span.left"),a=t.querySelector("span.right"),l=0,h=r[0].offsetWidth,c=Math.round(n.offsetWidth/h),d=n.offsetWidth/c,u=i||4e3;if(!(c>=r.length)){var m,g=[],v=function(){g=[];for(var t=0;t<r.length;t++)g.push(new p(r[t],d))};window.ResizeObserver&&(m=new ResizeObserver((t=>{for(let i of t)if(i.target===n){var e=r[0].offsetWidth;e!==h&&(h=e,d=n.offsetWidth/c,v(),I(1))}})));var f=t.querySelector("ul.dots"),p=function(t,e){this.element=t,this.slotWidth=e,this.xPos=0,this.step=function(t,e){this.xPos-=this.slotWidth*t,this.move(this.xPos,e)},this.reset=function(){this.xPos=0,this.move(0)},this.move=function(t,e){var i=this.element;e?i.classList.add("transformHidden"):i.classList.remove("transformHidden"),i.style.transform="translateX("+t+"px)"};var i=this;return{step:function(t,e){i.step(t,e)},reset:function(){i.reset()}}},w=function(t,e){var i=l;l+=t,Math.abs(l)>=g.length&&(l=0),g.forEach((function(i){i.step(t,e)})),t>0?b(Math.abs(t)):t<0&&I(Math.abs(t)),x(l,i)},b=function(t){var e=g.shift();e.step(-2-g.length,!0),window.setTimeout((function(){e.step(1)}),50),g.push(e),--t>0&&b(t)},I=function(t){var e=g.pop();g.unshift(e),e.step(g.length,!0),--t>0&&I(t)};if(o&&o.addEventListener("click",(function(){w(-1),e=!1}),!1),a&&a.addEventListener("click",(function(){w(1),e=!1}),!1),f){for(var y=0;y<f.children.length;y++)f.children[y].addEventListener("click",S,!1);x(0)}v(),I(1),m&&m.observe(n),e&&(s=window.setInterval((function(){e?w(1):window.clearInterval(s)}),u))}}}}function S(t){t.preventDefault(),t.stopPropagation();var i,s=(i=this,Array.prototype.slice.call(i.parentNode.children).indexOf(i));s>-1&&w(s-l,!0),e=!1}function x(t,e){if(f){var i=f.children[e];i&&i.classList.remove("selected");var s=f.children[t];s&&s.classList.add("selected")}}},(()=>{window.Dac||(window.Dac={});let{Dac:t}=window;t.SwipeHelper=class{constructor(t,e){this.debug=window.location.toString().includes("debug="),this.log("Creating instance ..."),this.settings={isHorizontal:e.isHorizontal,css:{hidden:"nav-hidden"},navWidth:0,preloadNextImage:!!e.preloadNextImage,intersectionObserver:{threshold:void 0===e.threshold?.5:e.threshold},itemsSelector:e.itemsSelector};const i=e.navItemsSelector?t.querySelector(e.navItemsSelector):null,s=e.previewItemsSelector?t.querySelector(e.previewItemsSelector):null;this.elements={nav:{forward:t.querySelector(e.navItems.forwardSelector),backward:t.querySelector(e.navItems.backwardSelector)},itemsContainer:t.querySelector(e.itemsContainerSelector),items:t.querySelectorAll(this.settings.itemsSelector),navItems:i?[...i.children]:null,previewItems:s?[...s.children]:null},this.validateElement(this.elements.itemsContainer)&&this.validateElement(this.elements.items)?this.elements.items.length<2?this.log("To few elements. No need for the helper.",!0):(this.items=[...this.elements.items].map((t=>({visible:!1,element:t}))),this.index=null,this.observer=null,this.observeElements(this.elements.itemsContainer,this.elements.items),this.setupNavigation(),this.autoScrollInterval=null,this.autoScroll=e.autoScroll,this.elementWidth=this.items[0].element.scrollWidth,this.currentLeft=0,this.isAutoscrolling=!1,this.preloadedIndexes=[],this.registerAutoscroll()):this.log("Missing required dom-element(s).",!0)}reflow(){this.log("Will reflow items"),this.unobserve(this.elements.items),this.elements.items=this.elements.itemsContainer.querySelectorAll(this.settings.itemsSelector),this.items=[...this.elements.items].map((t=>({visible:!1,element:t}))),this.observeElements(this.elements.itemsContainer,this.elements.items)}log(t,e=!1){e&&console.warn("[SwipeHelper]",t),this.debug&&console.log("[SwipeHelper]",t)}validateElement(t){return t&&(t.length||1===t.nodeType)}registerAutoscroll(){if(!this.autoScroll||!this.autoScroll.enabled)return;this.autoScroll.interval||(this.autoScroll.interval=4e3);new IntersectionObserver(((t,e)=>{t[0].isIntersecting?this.startAutoScroll():this.stopAutoScroll()}),{root:null,rootMargin:"0px",threshold:0}).observe(this.elements.itemsContainer)}startAutoScroll(){if(this.isAutoscrolling)return;this.isAutoscrolling=!0,this.log("Starting autoscroll ..."),this.autoScrollInterval=setInterval((()=>{this.autoScroll.scrolling=!0,this.autoScroll.reset?(this.elements.itemsContainer.scrollTo({top:0,left:0,behavior:"smooth"}),this.autoScroll.reset=!1):this.elements.itemsContainer.scrollTo({top:0,left:this.elements.itemsContainer.scrollLeft+this.elementWidth,behavior:"smooth"}),setTimeout((()=>{this.autoScroll.scrolling=!1}),1e3)}),parseInt(this.autoScroll.interval,10));const t=()=>{this.autoScroll.scrolling||(this.log("Will disable autoscroll"),this.stopAutoScroll(),this.elements.itemsContainer.removeEventListener("scroll",t))};this.elements.itemsContainer.addEventListener("scroll",t)}stopAutoScroll(){this.isAutoscrolling&&(this.log("Stopping autoscroll ..."),clearInterval(this.autoScrollInterval),this.autoScrollInterval=null,this.isAutoscrolling=!1)}setupNavigation(){if(this.elements.nav.forward&&this.elements.nav.backward&&(this.log("Will register events for navigation."),this.settings.navWidth=this.elements.nav.backward.offsetWidth,this.elements.nav.backward.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),this.navigate(-1)}),!1),this.elements.nav.forward.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),this.navigate(1)}),!1)),this.elements.navItems)for(const t of this.elements.navItems){const e=this.elements.navItems.indexOf(t);t.addEventListener("click",(t=>{this.navigateToIndex(e,"auto")}),!1)}if(this.elements.previewItems)for(const t of this.elements.previewItems){const e=this.elements.previewItems.indexOf(t);t.addEventListener("click",(t=>{this.navigateToIndex(e,"auto")}),!1)}}navigateToIndex(t,e){this.log(`Navigate to index: ${t}`),this.items[t]&&this.navigateToItem(this.items[t],e)}navigate(t){const e=this.items.filter((t=>t.visible));if(!e.length)return void this.log("Cannot navigate. Did not find any visible items ...",!0);const i=this.items.indexOf(e.shift())+t;i>=0&&i<this.items.length&&this.navigateToItem(this.items[i])}navigateToItem(t,e="smooth"){if(this.settings.isHorizontal){const i=Math.max(0,t.element.offsetLeft-this.settings.navWidth);this.elements.itemsContainer.scrollTo({top:0,left:i,behavior:e})}else this.elements.itemsContainer.scrollTo({top:t.element.offsetTop,left:0,behavior:e})}observeElements(t,e){this.log(`Will register IntersectionObserver for ${e.length} items`);const i={root:t,rootMargin:"0px",threshold:this.settings.intersectionObserver.threshold};this.observer=new IntersectionObserver(((t,e)=>{const i=[];let s=null;for(const e of t){const t=Array.from(e.target.parentNode.children).indexOf(e.target);this.items[t].visible=e.isIntersecting,i.push(t),this.items[t].visible&&(s=t),this.settings.preloadNextImage&&e.isIntersecting&&this.items[t+1]&&!this.preloadedIndexes.includes(t+1)&&this.preloadAtIndex(t+1),this.log(`IntersectionObserver triggered at index ${t}. Setting visibility to ${this.items[t].visible}.`)}null!==s&&this.updateNavItems(s),(i.includes(0)||i.includes(this.items.length-1))&&(this.updateGui(),this.autoScroll&&this.autoScroll.enabled&&this.items[this.items.length-1].visible&&(this.autoScroll.reset=!0))}),i);for(const t of e)this.observer.observe(t)}unobserve(t){this.log(`Will unobserve ${t.length} items`);for(const e of t)this.observer.unobserve(e)}preloadAtIndex(t){if(this.preloadedIndexes.push(t),!this.items[t]||!this.items[t].element)return;const e=this.items[t].element.querySelector("img");e&&(this.log(`Will preload image at index ${t}`),e.removeAttribute("loading"))}updateGui(){this.elements.nav.forward&&this.elements.nav.backward&&(this.log("Updating navigation-GUI ..."),this.items[0].visible?this.elements.nav.backward.classList.add(this.settings.css.hidden):this.elements.nav.backward.classList.remove(this.settings.css.hidden),this.items[this.items.length-1].visible?this.elements.nav.forward.classList.add(this.settings.css.hidden):this.elements.nav.forward.classList.remove(this.settings.css.hidden))}updateNavItems(t){const e="selected";this.elements.navItems&&(this.elements.navItems[this.index]&&this.elements.navItems[this.index].classList.remove(e),this.elements.navItems[t]&&this.elements.navItems[t].classList.add(e)),this.elements.previewItems&&(this.elements.previewItems[this.index]&&this.elements.previewItems[this.index].classList.remove(e),this.elements.previewItems[t]&&this.elements.previewItems[t].classList.add(e)),this.index=t}}})(),window.Dac||(window.Dac={}),window.Dac.Parallax=class{constructor(t){this.container=t.container,this.debug=t.debug,this.log(`Starting Parallax-instance for element "${this.container.classList}".`),this.isAnimating=!1,this.handler=this.scrollHandler.bind(this),this.animator=this.animate.bind(this),this.register(this.container),this.elements=t.elements,this.resizeTimeoutId=null,this.lastYPos=window.scrollY,this.animatedItems=[],this.items=this.registerItems(this.elements),this.decorateStaticAttributes()}registerItems(t){this.log(`Will register ${t.length} item(s)`),document.body.classList.add("dac-reflow");const e=t.map((t=>{const e=this.container.querySelector(t.selector),i=e.getBoundingClientRect();return{index:t.index,element:e,rect:i,animations:t.animations,staticAttributes:t.staticAttributes,style:"",position:{top:parseInt(i.top+window.scrollY,10),bottom:parseInt(i.bottom+window.scrollY,10)}}}));return document.body.classList.remove("dac-reflow"),e}reflow(){this.log("Will reflow items"),this.items=this.registerItems(this.elements)}scrollHandler(t){this.requestAnimation()}decorateStaticAttributes(){for(const t of this.items){const e=t.staticAttributes.map((e=>this[`handleStatic_${e.name}`](e,t)));t.element.setAttribute("style",`transform: ${e.join(" ")}`)}}getItemsByPosition(t,e){return this.items.filter((i=>i.position.top<e&&i.position.bottom>t))}getPercentScroll(t,e){const i=Math.max(t.position.top-window.innerHeight,0);return(e-i)/(t.position.bottom-i)*100}log(t){this.debug&&console.log("Parallax:",t)}requestAnimation(){this.isAnimating||requestAnimationFrame(this.animator),this.isAnimating=!0}activateAnimations(){this.log("Will activate animations"),this.container.classList.add("parallax-js-mode"),window.addEventListener("scroll",this.handler,!1),this.handler()}deactivateAnimations(){this.log("Will deactivate animations"),this.container.style.height="",this.container.classList.remove("parallax-js-mode"),window.removeEventListener("scroll",this.handler,!1)}register(t){this.log("Will register IntersectionObserver"),new IntersectionObserver(((e,i)=>{for(const i of e)i.target===t&&(this.log(`IntersectionObserver triggered. Intersecting: ${i.isIntersecting}, ratio: ${i.intersectionRatio}`),i.isIntersecting?this.activateAnimations():this.deactivateAnimations())}),{root:null,rootMargin:"0px"}).observe(t),window.addEventListener("resize",(t=>{this.log("Window resized"),clearTimeout(this.resizeTimeoutId),this.resizeTimeoutId=setTimeout((()=>{this.reflow()}),300)}))}getFloat(t,e=2){return parseFloat(t.toFixed(e))}getInt(t){return parseInt(t,10)}getCurrentValue(t,e){return e<t.startScrollPosition?parseFloat(t.startValue):e>=t.endScrollPosition?parseFloat(t.endValue):100/(t.endScrollPosition-t.startScrollPosition)*(e-t.startScrollPosition)/100*(t.endValue-t.startValue)+parseFloat(t.startValue)}animate(){const t=this.getItemsByPosition(window.scrollY,window.scrollY+window.innerHeight);if(this.debug){const e=t.map((t=>`[${t.animations.map((t=>t.name)).join(", ")}]`));this.log(`Will animate ${t.length} element(s) ${e.join(", ")}`)}for(const e of this.animatedItems)t.includes(e)||(this.log("Setting start/end state for item outside range."),this.animateItem(e,this.lastYPos<=window.scrollY?100:0),e.element.classList.remove("isAnimating"));for(const e of t){e.element.classList.add("isAnimating");const t=this.getPercentScroll(e,window.scrollY);this.animateItem(e,t)}this.lastYPos=window.scrollY,this.isAnimating=!1,this.animatedItems=t}animateItem(t,e){const i={transform:[],filter:[],definition:[]};for(const s of t.animations){const n=this[`handleAnimation_${s.name}`](s,e,t);i[n.key].push(n.value)}if(i.transform.length&&i.definition.push(`transform: ${i.transform.join(" ")}`),i.filter.length&&i.definition.push(`filter: ${i.filter.join(" ")}`),i.definition.length){const e=i.definition.join("; ");t.style!==e&&(t.element.setAttribute("style",i.definition.join("; ")),t.style=e)}}handleAnimation_perspective(t,e,i){const s=this.getCurrentValue(t,e/100)/100;return{key:"transform",value:`translateZ(${this.getFloat(100*s)}px) scale(${this.getFloat(s)})`}}handleAnimation_scale(t,e,i){const s=this.getCurrentValue(t,e)/100;return{key:"transform",value:`scale(${this.getFloat(s,4)})`}}handleAnimation_opacity(t,e,i){const s=this.getCurrentValue(t,e)/100;return{key:"definition",value:`opacity:${this.getFloat(s)}`}}handleAnimation_rotate(t,e,i){const s=this.getCurrentValue(t,e)/100*360;return{key:"transform",value:`rotate(${this.getInt(s)}deg)`}}handleAnimation_blur(t,e,i){const s=this.getCurrentValue(t,e)/2;return{key:"filter",value:`blur(${this.getFloat(s)}px)`}}handleAnimation_sepia(t,e,i){const s=this.getCurrentValue(t,e);return{key:"filter",value:`sepia(${this.getInt(s)}%)`}}handleAnimation_brightness(t,e,i){const s=this.getCurrentValue(t,e);return{key:"filter",value:`brightness(${this.getInt(s)}%)`}}handleStatic_perspective(t,e){const i=this.getFloat(t.value/100);return{key:"transform",value:`translateZ(${t.value}px) scale(${i})`}}},window.Dac=window.Dac||{},window.Dac.TabNavigation=class{constructor(t){this.index=null,this.debug=!!t.debug,this.canCloseTabs=!!t.canCloseTabs,this.onNavigate=t.onNavigate||(()=>{}),this.log("Creating instance ..."),this.elements={container:null,tabs:null,navigationItems:null},this.setup(t)?(this.activeSelector="selected",this.setupNavigation(),t.defaultIndex&&!isNaN(t.defaultIndex)&&this.setIndex(parseInt(t.defaultIndex,10))):this.log("Missing required dom-elements.",!0)}log(t,e=!1){e?console.warn("TabNavigation:",t):this.debug&&console.log("TabNavigation:",t)}setup(t){return this.elements.container=document.querySelector(t.selector),!!this.elements.container&&(this.elements.tabs=this.elements.container.querySelectorAll(t.tabsSelector),this.elements.navigationItems=this.elements.container.querySelectorAll(t.navigationSelector),this.log(`Found ${this.elements.tabs.length} tab-elements and ${this.elements.navigationItems.length} navigation items.`),this.elements.tabs.length>0&&this.elements.navigationItems.length>0)}setupNavigation(){this.log("Will register events for navigation.");let t=0;for(const e of this.elements.navigationItems)this.setupNavigationItem(e,t),t++}setupNavigationItem(t,e){t.addEventListener("click",(t=>{t.stopPropagation();const i=this.index;this.setIndex(e),this.onNavigate(this.createCallbackObject(i),this.createCallbackObject(this.index))}),!1)}createCallbackObject(t){return null===t?null:{tab:this.elements.tabs[t],navigator:this.elements.navigationItems[t]}}setIndex(t){if(this.index===t){if(!this.canCloseTabs)return void this.log(`Index ${t} already defined. No change.`);t=null}t<0||t>=this.elements.tabs.length?this.log(`Index ${t} is out of bounds.`,!0):(this.log(`Will set index ${t}.`),this.index=t,this.updateGui())}updateGui(){for(const t of this.elements.tabs)t.classList.remove(this.activeSelector);for(const t of this.elements.navigationItems)t.classList.remove(this.activeSelector);this.elements.tabs[this.index]&&this.elements.tabs[this.index].classList.add(this.activeSelector),this.elements.navigationItems[this.index]&&this.elements.navigationItems[this.index].classList.add(this.activeSelector)}},window.Dac||(window.Dac={}),window.Dac.ElementAttributeToggler=class{constructor(t={selectors:[]}){this.validate(t),this.options=t,this.selectors=this.getSelectorsElements(),this.setup()}setup(){this.selectors.forEach((t=>{this.setInitialAttributes(t),this.addListeners(t)}))}getSelectorsElements(){return this.options.selectors.map((t=>({activators:document.querySelectorAll(t.toggleActivator),elements:document.querySelectorAll(t.elementToToggle),attributes:t.attributes})))}setInitialAttributes(t){const e=t.attributes;t.elements.forEach(((t,i)=>{for(const i of Object.keys(e||{}))e[i].initial&&this.setAttribute(t,i,e[i].value)}))}setAttribute(t,e,i){"className"===e?t.classList.add(i):t[e]=i}addListeners(t){t.activators.forEach(((e,i)=>{e.addEventListener("click",(e=>{e.preventDefault(),this.segregateAttributeHandlers(t.elements[i],t)}))}))}segregateAttributeHandlers(t,e){const i=e.attributes;for(const e of Object.keys(i||{}))"className"===e?this.toggleClassName(t,i[e].value):this.toggleAnyAttribute(t,i[e].value,e)}toggleClassName(t,e){t.classList.toggle(e)}toggleAnyAttribute(t,e,i){t[i]===e?t[i]="":t[i]=e}validate(t){return this.validateObject(t)?this.validateArray(t.selectors)?void 0:(console.error("ElementAttributeToggler: Options.selectors is not an array."),!1):(console.error("ElementAttributeToggler: Options is not an object."),!1)}validateObject(t){return"object"==typeof t&&null!==t}validateArray(t){return Array.isArray(t)}},t=void 0,e=function(){var t=Object.prototype.toString,e=Array.isArray||function(e){return"[object Array]"===t.call(e)};function i(t){return"function"==typeof t}function s(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function n(t,e){return null!=t&&"object"==typeof t&&e in t}var r=RegExp.prototype.test,o=/\S/;function a(t){return!function(t,e){return r.call(t,e)}(o,t)}var l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},h=/\s*/,c=/\s+/,d=/\s*=/,u=/\s*\}/,m=/#|\^|\/|>|\{|&|=|!/;function g(t){this.string=t,this.tail=t,this.pos=0}function v(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function f(){this.templateCache={_cache:{},set:function(t,e){this._cache[t]=e},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}g.prototype.eos=function(){return""===this.tail},g.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var i=e[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i},g.prototype.scanUntil=function(t){var e,i=this.tail.search(t);switch(i){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,i),this.tail=this.tail.substring(i)}return this.pos+=e.length,e},v.prototype.push=function(t){return new v(t,this)},v.prototype.lookup=function(t){var e,s,r,o=this.cache;if(o.hasOwnProperty(t))e=o[t];else{for(var a,l,h,c=this,d=!1;c;){if(t.indexOf(".")>0)for(a=c.view,l=t.split("."),h=0;null!=a&&h<l.length;)h===l.length-1&&(d=n(a,l[h])||(s=a,r=l[h],null!=s&&"object"!=typeof s&&s.hasOwnProperty&&s.hasOwnProperty(r))),a=a[l[h++]];else a=c.view[t],d=n(c.view,t);if(d){e=a;break}c=c.parent}o[t]=e}return i(e)&&(e=e.call(this.view)),e},f.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},f.prototype.parse=function(t,i){var n=this.templateCache,r=t+":"+(i||p.tags).join(":"),o=void 0!==n,l=o?n.get(r):void 0;return null==l&&(l=function(t,i){if(!t)return[];var n,r,o,l=!1,v=[],f=[],w=[],b=!1,I=!1,y="",S=0;function x(){if(b&&!I)for(;w.length;)delete f[w.pop()];else w=[];b=!1,I=!1}function A(t){if("string"==typeof t&&(t=t.split(c,2)),!e(t)||2!==t.length)throw new Error("Invalid tags: "+t);n=new RegExp(s(t[0])+"\\s*"),r=new RegExp("\\s*"+s(t[1])),o=new RegExp("\\s*"+s("}"+t[1]))}A(i||p.tags);for(var L,C,k,E,T,$,W=new g(t);!W.eos();){if(L=W.pos,k=W.scanUntil(n))for(var P=0,O=k.length;P<O;++P)a(E=k.charAt(P))?(w.push(f.length),y+=E):(I=!0,l=!0,y+=" "),f.push(["text",E,L,L+1]),L+=1,"\n"===E&&(x(),y="",S=0,l=!1);if(!W.scan(n))break;if(b=!0,C=W.scan(m)||"name",W.scan(h),"="===C?(k=W.scanUntil(d),W.scan(d),W.scanUntil(r)):"{"===C?(k=W.scanUntil(o),W.scan(u),W.scanUntil(r),C="&"):k=W.scanUntil(r),!W.scan(r))throw new Error("Unclosed tag at "+W.pos);if(T=">"==C?[C,k,L,W.pos,y,S,l]:[C,k,L,W.pos],S++,f.push(T),"#"===C||"^"===C)v.push(T);else if("/"===C){if(!($=v.pop()))throw new Error('Unopened section "'+k+'" at '+L);if($[1]!==k)throw new Error('Unclosed section "'+$[1]+'" at '+L)}else"name"===C||"{"===C||"&"===C?I=!0:"="===C&&A(k)}if(x(),$=v.pop())throw new Error('Unclosed section "'+$[1]+'" at '+W.pos);return function(t){for(var e,i=[],s=i,n=[],r=0,o=t.length;r<o;++r)switch((e=t[r])[0]){case"#":case"^":s.push(e),n.push(e),s=e[4]=[];break;case"/":n.pop()[5]=e[2],s=n.length>0?n[n.length-1][4]:i;break;default:s.push(e)}return i}(function(t){for(var e,i,s=[],n=0,r=t.length;n<r;++n)(e=t[n])&&("text"===e[0]&&i&&"text"===i[0]?(i[1]+=e[1],i[3]=e[3]):(s.push(e),i=e));return s}(f))}(t,i),o&&n.set(r,l)),l},f.prototype.render=function(t,e,i,s){var n=this.parse(t,s),r=e instanceof v?e:new v(e,void 0);return this.renderTokens(n,r,i,t,s)},f.prototype.renderTokens=function(t,e,i,s,n){for(var r,o,a,l="",h=0,c=t.length;h<c;++h)a=void 0,"#"===(o=(r=t[h])[0])?a=this.renderSection(r,e,i,s):"^"===o?a=this.renderInverted(r,e,i,s):">"===o?a=this.renderPartial(r,e,i,n):"&"===o?a=this.unescapedValue(r,e):"name"===o?a=this.escapedValue(r,e):"text"===o&&(a=this.rawValue(r)),void 0!==a&&(l+=a);return l},f.prototype.renderSection=function(t,s,n,r){var o=this,a="",l=s.lookup(t[1]);if(l){if(e(l))for(var h=0,c=l.length;h<c;++h)a+=this.renderTokens(t[4],s.push(l[h]),n,r);else if("object"==typeof l||"string"==typeof l||"number"==typeof l)a+=this.renderTokens(t[4],s.push(l),n,r);else if(i(l)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");null!=(l=l.call(s.view,r.slice(t[3],t[5]),(function(t){return o.render(t,s,n)})))&&(a+=l)}else a+=this.renderTokens(t[4],s,n,r);return a}},f.prototype.renderInverted=function(t,i,s,n){var r=i.lookup(t[1]);if(!r||e(r)&&0===r.length)return this.renderTokens(t[4],i,s,n)},f.prototype.indentPartial=function(t,e,i){for(var s=e.replace(/[^ \t]/g,""),n=t.split("\n"),r=0;r<n.length;r++)n[r].length&&(r>0||!i)&&(n[r]=s+n[r]);return n.join("\n")},f.prototype.renderPartial=function(t,e,s,n){if(s){var r=i(s)?s(t[1]):s[t[1]];if(null!=r){var o=t[6],a=t[5],l=t[4],h=r;return 0==a&&l&&(h=this.indentPartial(r,l,o)),this.renderTokens(this.parse(h,n),e,s,h,n)}}},f.prototype.unescapedValue=function(t,e){var i=e.lookup(t[1]);if(null!=i)return i},f.prototype.escapedValue=function(t,e){var i=e.lookup(t[1]);if(null!=i)return"number"==typeof i?String(i):p.escape(i)},f.prototype.rawValue=function(t){return t[1]};var p={name:"mustache.js",version:"4.0.1",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){w.templateCache=t},get templateCache(){return w.templateCache}},w=new f;return p.clearCache=function(){return w.clearCache()},p.parse=function(t,e){return w.parse(t,e)},p.render=function(t,i,s,n){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+(e(r=t)?"array":typeof r)+'" was given as the first argument for mustache#render(template, view, partials)');var r;return w.render(t,i,s,n)},p.escape=function(t){return String(t).replace(/[&<>"'`=\/]/g,(function(t){return l[t]}))},p.Scanner=g,p.Context=v,p.Writer=f,p},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Mustache=e()})();